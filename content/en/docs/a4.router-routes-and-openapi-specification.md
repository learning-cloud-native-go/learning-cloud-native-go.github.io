---
title: Router, routes and OpenAPI specification
slug: "router-routes-and-openapi-specification"
---

> **👨‍🏫 Before we start...**
> - First, we will create a predictable, uniform interface for developing APIs based on the "Resource oriented
    architecture"
> - There are a few popular router packages in the Go ecosystem, like [`gorilla/mux`](https://github.com/gorilla/mux)
    , [`go-chi/chi`](https://github.com/go-chi/chi), [`buaazp/fasthttprouter`](https://github.com/buaazp/fasthttprouter)
    . In this project, we'll use [`go-chi/chi`](https://github.com/go-chi/chi) because of it is lightweight and 100%
    compatible with `net/http`.
> - There are some limitations in OpenAPI specification generators in the Go ecosystem. The packages
    like [swaggest/rest](https://github.com/swaggest/rest)
    , [deepmap/oapi-codegen](https://github.com/deepmap/oapi-codegen) support OpenAPI 3 but those are custom boilerplate
    generators with/from OpenAPI 3 specifications. [swaggo/swag](https://github.com/swaggo/swag) converts Go annotations
    to OpenAPI specifications but still support only OpenAPI 2/ Swagger 2.0 specifications. In this project, we'll go
    with [swaggo/swag](https://github.com/swaggo/swag).

## Resource oriented design

Resource oriented design helps to create a predictable, uniform interface for designing and developing APIs by grouping
individually named resources (nouns) and their relations with a small number of standard methods (verbs).

In this project, we will use the following resources and method names to implement a simple RESTful bookshelf API in Go.

| Functionality | Resource | Method name | HTTP Method | Route          |
|---------------|----------|-------------|-------------|----------------|
| API Health    | health   | Read        | GET         | /livez         |
|               |          |             |             |                |
| List Books    | book     | List        | GET         | /v1/books      |
| Create Book   | book     | Create      | POST        | /v1/books      |
| Read Book     | book     | Read        | GET         | /v1/books/{id} |
| Update Book   | book     | Update      | PUT         | /v1/books/{id} |
| Delete Book   | book     | Delete      | DELETE      | /v1/books/{id} |

> [🔍](https://en.wikipedia.org/wiki/Resource-oriented_architecture) Resource-oriented architecture (ROA) is a style of
> software architecture and programming paradigm for supportively designing and developing software in the form of
> inter-networking of resources with "RESTful" interfaces, first described by Leonard Richardson and Sam Ruby in their
> book "RESTful Web Services" in 2007.
>
> ⭐️ Some web frameworks and ecosystems use `List, Create, Get, Update, Delete` method names. But, in this project,
> we'll align with `List, Count, Create, Read, Update, Delete` method names (`Count` is to get the total/filtered items
> count of the collection).

## Adding router and routes

### 1. Adding Chi router

`go get github.com/go-chi/chi/v5`

### 2. Add `api/resource/health/handler.go`

```go
package health

import "net/http"

func Read(w http.ResponseWriter, r *http.Request) {}
```

### 3. Add `api/resource/book/handler.go`

```go
package book

import "net/http"

type API struct{}

func (a *API) List(w http.ResponseWriter, r *http.Request) {}

func (a *API) Create(w http.ResponseWriter, r *http.Request) {}

func (a *API) Read(w http.ResponseWriter, r *http.Request) {}

func (a *API) Update(w http.ResponseWriter, r *http.Request) {}

func (a *API) Delete(w http.ResponseWriter, r *http.Request) {}
```

### 4. Add `api/router/router.go`

```go
package router

import (
	"github.com/go-chi/chi/v5"

	"myapp/api/resource/book"
	"myapp/api/resource/health"
)

func New() *chi.Mux {
	r := chi.NewRouter()

	r.Get("/livez", health.Read)

	r.Route("/v1", func(r chi.Router) {
		bookAPI := &book.API{}
		r.Get("/books", bookAPI.List)
		r.Post("/books", bookAPI.Create)
		r.Get("/books/{id}", bookAPI.Read)
		r.Put("/books/{id}", bookAPI.Update)
		r.Delete("/books/{id}", bookAPI.Delete)
	})

	return r
}
```

### 5. Update `cmd/api/main.go`

````go
package main

import (
	"fmt"
	"log"
	"net/http"

	"myapp/api/router"
	"myapp/config"
)

func main() {
	c := config.New()
	r := router.New()
	s := &http.Server{
		Addr:         fmt.Sprintf(":%d", c.Server.Port),
		Handler:      r,
		ReadTimeout:  c.Server.TimeoutRead,
		WriteTimeout: c.Server.TimeoutWrite,
		IdleTimeout:  c.Server.TimeoutIdle,
	}

	log.Println("Starting server " + s.Addr)
	if err := s.ListenAndServe(); err != nil && err != http.ErrServerClosed {
		log.Fatal("Server startup failed")
	}
}
````

## Generating OpenAPI specification

```json
{
	"id": "string",
	"title": "string",
	"author": "string",
	"published_date": "date",
	"image_url": "string",
	"description": "string"
}
```

```json
{
	"title": "string",
	"author": "string",
	"published_date": "date",
	"image_url": "string",
	"description": "string"
}
```


### 1. Install `swaggo/swag`

`go install github.com/swaggo/swag/cmd/swag@latest`

### 2. Add `api/resource/book/model.go`

```go
package book

type DTO struct {
	ID            string `json:"id"`
	Title         string `json:"title"`
	Author        string `json:"author"`
	PublishedDate string `json:"published_date"`
	ImageURL      string `json:"image_url"`
	Description   string `json:"description"`
}

type Form struct {
	Title         string `json:"title"`
	Author        string `json:"author"`
	PublishedDate string `json:"published_date"`
	ImageURL      string `json:"image_url"`
	Description   string `json:"description"`
}
```

### 3. Add `api/resource/common/err/err.go`

```go
package err

type Error struct {
	Error string `json:"error"`
}

type Errors struct {
	Errors []string `json:"errors"`
}
```

### 4. `cmd/api/main.go`

```go
//	@title			MYAPP API
//	@version		1.0
//	@description	This is a sample RESTful API with a CRUD

//	@contact.name	Dumindu Madunuwan
//	@contact.url	https://learning-cloud-native-go.github.io

//	@license.name	MIT License
//	@license.url	https://github.com/learning-cloud-native-go/myapp/blob/master/LICENSE

//	@host		localhost:8080
//	@basePath	/v1
func main() {
```

### 5. update `api/resource/health/handler.go`

```go
// Read godoc
//
//	@summary		Read health
//	@description	Read health
//	@tags			health
//	@success		200
//	@router			/../livez [get]
func Read(w http.ResponseWriter, r *http.Request) {}
```

### 6. update `api/resource/book/handler.go`

```go
// List godoc
//
//	@summary		List books
//	@description	List books
//	@tags			books
//	@accept			json
//	@produce		json
//	@success		200	{array}		DTO
//	@failure		500	{object}	err.Error
//	@router			/books [get]
func List(w http.ResponseWriter, r *http.Request) {}

// Create godoc
//
//	@summary		Create book
//	@description	Create book
//	@tags			books
//	@accept			json
//	@produce		json
//	@param			body	body	Form	true	"Book form"
//	@success		201
//	@failure		422	{object}	err.Errors
//	@failure		500	{object}	err.Error
//	@router			/books [post]
func Create(w http.ResponseWriter, r *http.Request) {}

// Read godoc
//
//	@summary		Read book
//	@description	Read book
//	@tags			books
//	@accept			json
//	@produce		json
//	@param			id	path		string	true	"Book ID"
//	@success		200	{object}	DTO
//	@failure		400	{object}	err.Error
//	@failure		404
//	@failure		500	{object}	err.Error
//	@router			/books/{id} [get]
func Read(w http.ResponseWriter, r *http.Request) {}

// Update godoc
//
//	@summary		Update book
//	@description	Update book
//	@tags			books
//	@accept			json
//	@produce		json
//	@param			id		path	string	true	"Book ID"
//	@param			body	body	Form	true	"Book form"
//	@success		200
//	@failure		400	{object}	err.Error
//	@failure		404
//	@failure		422	{object}	err.Errors
//	@failure		500	{object}	err.Error
//	@router			/books/{id} [put]
func Update(w http.ResponseWriter, r *http.Request) {}

// Delete godoc
//
//	@summary		Delete book
//	@description	Delete book
//	@tags			books
//	@accept			json
//	@produce		json
//	@param			id	path	string	true	"Book ID"
//	@success		200
//	@failure		400	{object}	err.Error
//	@failure		404
//	@failure		500	{object}	err.Error
//	@router			/books/{id} [delete]
func Delete(w http.ResponseWriter, r *http.Request) {}
```

### 7. Generate Swagger docs

- Format Swagger comments : `swag fmt`
- Generate Swagger docs: `swag init -g cmd/api/main.go -o .swagger`

> 💡Update `.gitignore` to add `.swagger`


## middleware


## 📁 Final project structure

```shell
myapp
├── cmd
│  ├── api
│  │  └── main.go
│  └── migrate
│     └── main.go
│
├── api
│  ├── router
│  │  ├── router.go
│  │  └── middleware
│  │     └── content_type.go
│  │
│  └── resource
│     ├── health
│     │  └── handler.go
│     ├── book
│     │  ├── handler.go
│     │  └── model.go
│     └── common
│        └── err
│           └── err.go
│
├── migrations
│  └── 00001_create_books_table.sql
│
├── config
│  └── config.go
│
├── .env
│
├── go.mod
├── go.sum
│
├── docker-compose.yml
└── Dockerfile
```

## 👨‍🏫 What's next…